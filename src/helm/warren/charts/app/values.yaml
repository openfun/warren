# Default values for app.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

image:
  repository: fundocker/warren
  pullPolicy: IfNotPresent
  tag: "app-main"

replicaCount: 1

imagePullSecrets: []

podAnnotations: {}

service:
  type: NodePort
  nodePort:
    http: 30080

ingress:
  enabled: true
  class_name: "nginx"
  host: ""
  annotations: {}
  tls:
    enabled: false
    certificateSecretName: warren-app-certificate

persistence:
  enabled: true
  storageClass: "standard"
  accessModes:
    - ReadWriteMany
  size: 2Gi

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: deployment
                operator: In
                values:
                  - "warren-app-app"
          topologyKey: kubernetes.io/hostname

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

volumes:
  media:
    name: "warren-app-media"
    claimName: "warren-app-media-pvc"
    mountPath: "/app/media"

# Django application configuration
django:
  fullname: app
  port: 8080
  settings: "warren.settings"
  configuration: "Production"
  accessTokenLifetime: "300"
  ltiAccessTokenLifetime: "86400"
  refreshTokenLifetime: "86400"
  signingAlgorithm: "HS256"
  apiRootUrl: "http://localhost:8100"
  appRootUrl: "http://localhost:8090"
  corsAllowedOrigins:
    - "http://localhost:8090"
  allowedHosts: 
    - "*"
  db:
    name: "warren-app"
    user: "fun"
    host: "warren-postgresql"
    port: "5432"
  command:
    - "gunicorn"
    - "--config"
    - "/usr/local/etc/gunicorn/warren.py"
    - "--bind"
    - "0.0.0.0:8080"
    - "warren.wsgi:application"
  jobs:
    - name: dbmigrate
      command: 
        - "python"
        - "manage.py" 
        - "migrate"
        - "--no-input"
  resources: {}

env:
  secret: []

nginx:
  port: 8000
